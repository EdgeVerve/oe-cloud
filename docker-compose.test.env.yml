version: "3"
services:
  web:
    entrypoint: ${STARTUP_CMD}
    image: ${REGISTRY}/${APP_IMAGE_NAME}:${APP_TAG}
    depends_on:
      - mongo
      - postgres
    environment:
      NODE_ENV: ${NODE_ENV}
      POSTGRES_HOST: "postgres"
      MONGO_HOST: "mongo"
      CONFIG: ${CONFIG}
      DATASOURCES: ${DATASOURCES}
      PROVIDERS: ${PROVIDERS}
      NODE_TLS_REJECT_UNAUTHORIZED: "0"
      ORACLE_HOST: ${ORACLE_HOST}
      ORACLE_SID: ${ORACLE_SID}
      ORACLE_USERNAME: ${ORACLE_USERNAME}
      ORACLE_PASSWORD: ${ORACLE_PASSWORD}
    deploy:
      restart_policy:
        condition: none
  mongo:
    image: ${REGISTRY}/alpine-mongo:latest
    deploy:
      restart_policy:
        condition: none
  postgres:
    image: ${REGISTRY}/alpine-postgres:latest
    deploy:
      restart_policy:
        condition: none